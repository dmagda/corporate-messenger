# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/config-gitpod-file)
# and commit this file to your remote git repository to share the goodness with others.

image:
  file: .gitpod.Dockerfile

tasks:
  - name: Next.js Dev
    init: npm instal
    command: npm run dev

  - name: profile-service-node1
    before: |
      yugabyted start --base_dir=$STORE/ybd1 --listen=127.0.0.1 \
        --tserver_flags="placement_cloud=aws,placement_region=us-west-1,placement_zone=us-west-1a" \
        --master_flags="placement_cloud=aws,placement_region=us-west-1,placement_zone=us-west-1a" \
      gp sync-done profile-service-node1-ready
  - name: profile-service-node2
    before: |
      gp sync-await profile-service-node1-ready
      yugabyted start --base_dir=$STORE/ybd2 --listen=127.0.0.2 --join=127.0.0.1 \
        --tserver_flags="placement_cloud=aws,placement_region=eu-west-1,placement_zone=eu-west-1a" \
        --master_flags="placement_cloud=aws,placement_region=eu-west-1,placement_zone=eu-west-1a" \
      gp sync-done profile-service-node2-ready
  - name: profile-service-node3
    before: |
      gp sync-await profile-service-node2-ready
      yugabyted start --base_dir=$STORE/ybd3 --listen=127.0.0.3 --join=127.0.0.1 \
        --tserver_flags="placement_cloud=aws,placement_region=ap-south-1,placement_zone=ap-south-1a" \
        --master_flags="placement_cloud=aws,placement_region=ap-south-1,placement_zone=ap-south-1a" \      
      gp sync-done profile-service-node3-ready
  - name: Profile YB Shell
    command: |
      gp sync-await profile-service-node3-ready
      ysqlsh -f /var/sql_scripts/profile_service_schema.sql
      ysqlsh -h 127.0.0.1
    openMode: split-right   

ports:
  - port: 5433
    visibility: public
    onOpen: notify
  - port: 7000
    visibility: public
    onOpen: notify
  - port: 9000
    visibility: public
    onOpen: notify    